<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„ªæƒ æ ¸éŠ·ç³»çµ± - BrewDate</title>
    <!-- SEO å„ªåŒ– meta æ¨™ç±¤ -->
    <meta name="description" content="BREWDATE å•†å®¶åˆä½œå¹³å° - å¿«é€Ÿä¾¿æ·çš„å„ªæƒ æ ¸éŠ·ç³»çµ±ï¼Œè®“æ ¸éŠ·æµç¨‹æ›´è¼•é¬†ã€‚">
    <meta name="keywords" content="BREWDATE, å„ªæƒ æ ¸éŠ·, åº—å®¶å¹³å°, ç´„æœƒå ´æ‰€, åˆä½œå¤¥ä¼´">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="auth.css">
    <link rel="icon" href="logo_s.png" type="image/png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <!-- 1. é¦–å…ˆåŠ è¼‰ reCAPTCHA è…³æœ¬ (éå¸¸é‡è¦) -->
    <script src="https://www.google.com/recaptcha/api.js?render=6Lf0pfMqAAAAAPWeK67sgdduOfMbWeB5w0-0bG6G" 
        async 
        onload="console.log('reCAPTCHA è…³æœ¬åŠ è¼‰æˆåŠŸ', new Date().toISOString())" 
        onerror="console.error('reCAPTCHA è…³æœ¬åŠ è¼‰å¤±æ•—', new Date().toISOString())"></script>
    
    <!-- 2. ç„¶å¾ŒåŠ è¼‰ Firebase å’Œ App Check æ¨¡çµ„ -->
    <script type="module">
        // å…ˆå°å…¥ Firebase é…ç½®
        import './firebase-config.js';
        
        // å°å…¥çµ±ä¸€çš„ App Check æ¨¡çµ„
        import { addDiagnosticsPanel, checkAppCheckStatus, getAppCheckToken, installXHRInterceptor, installFetchInterceptor } from './app-check-module.js';
        
        // æ·»åŠ è¨ºæ–·æŒ‰éˆ•
        document.addEventListener('DOMContentLoaded', () => {
            // å‰µå»ºè¨ºæ–·æŒ‰éˆ•
            const diagnosticsBtn = document.createElement('button');
            diagnosticsBtn.id = 'appCheckDiagnosticsBtn';
            diagnosticsBtn.innerHTML = 'ğŸ”';
            diagnosticsBtn.title = 'App Check è¨ºæ–·';
            diagnosticsBtn.style.position = 'fixed';
            diagnosticsBtn.style.bottom = '20px';
            diagnosticsBtn.style.right = '20px';
            diagnosticsBtn.style.width = '50px';
            diagnosticsBtn.style.height = '50px';
            diagnosticsBtn.style.borderRadius = '50%';
            diagnosticsBtn.style.backgroundColor = '#007bff';
            diagnosticsBtn.style.color = 'white';
            diagnosticsBtn.style.border = 'none';
            diagnosticsBtn.style.fontSize = '20px';
            diagnosticsBtn.style.display = 'flex';
            diagnosticsBtn.style.alignItems = 'center';
            diagnosticsBtn.style.justifyContent = 'center';
            diagnosticsBtn.style.cursor = 'pointer';
            diagnosticsBtn.style.zIndex = '9999';
            diagnosticsBtn.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            
            // æ·»åŠ é»æ“Šäº‹ä»¶
            diagnosticsBtn.addEventListener('click', () => {
                addDiagnosticsPanel();
                diagnosticsBtn.style.display = 'none';
            });
            
            // æ·»åŠ åˆ°é é¢
            document.body.appendChild(diagnosticsBtn);
        });
        
        // å°å…¥æ ¸éŠ·é é¢å°ˆç”¨çš„ JavaScript
        import './verify.js';
    </script>
    
    <!-- æ·»åŠ  App Check ç‹€æ…‹æŒ‡ç¤ºå™¨çš„æ¨£å¼ -->
    <style>
        #appCheckStatus {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 9999;
            display: none;
        }
        
        #appCheckStatus.initializing {
            background-color: #ffeeba;
            color: #856404;
            display: block;
        }
        
        #appCheckStatus.success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }
        
        #appCheckStatus.error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        /* æ ¸éŠ·ç³»çµ±æ¨£å¼ */
        .verification-section {
            padding: 100px 0 60px;
            min-height: calc(100vh - 200px);
            background-color: var(--background-color);
        }
        
        .verification-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .verification-card {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 0;
            overflow: hidden;
            position: relative;
        }
        
        .verification-tabs {
            display: flex;
            border-bottom: 1px solid #eee;
        }
        
        .verification-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .verification-tab.active {
            background-color: var(--primary-light);
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }
        
        .verification-content {
            padding: 40px;
        }
        
        .verification-title {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .verification-description {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .verification-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .verification-input {
            margin-bottom: 20px;
        }
        
        .verification-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
        }
        
        .verification-input input {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .verification-input input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(157, 127, 134, 0.2);
            outline: none;
        }
        
        .verification-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px 30px;
            width: 100%;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .verification-button:hover {
            background: #86686F;
            transform: translateY(-2px);
        }
        
        .verification-scanner {
            margin-bottom: 30px;
            text-align: center;
        }
        
        #qrScanner {
            width: 100%;
            max-width: 400px;
            height: 300px;
            background-color: #f9f9f9;
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .scan-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .scan-frame {
            width: 200px;
            height: 200px;
            border: 2px solid var(--primary-color);
            border-radius: 20px;
            position: relative;
        }
        
        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: var(--primary-color);
            top: 50%;
            animation: scan 2s infinite linear;
        }
        
        @keyframes scan {
            0% { top: 20%; }
            50% { top: 80%; }
            100% { top: 20%; }
        }
        
        .verification-result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 10px;
            background-color: #f9f9f9;
            display: none;
        }
        
        .verification-result.success {
            background-color: #d4edda;
            border-left: 5px solid #28a745;
        }
        
        .verification-result.error {
            background-color: #f8d7da;
            border-left: 5px solid #dc3545;
        }
        
        .tabs-container {
            display: none;
        }
        
        .tabs-container.active {
            display: block;
        }
        
        .camera-permission-btn {
            margin-top: 10px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
        }
        
        .camera-permission-btn:hover {
            background-color: #5a6268;
        }
    </style>
    
    <script src="error-handler.js"></script>
</head>
<body>
    <!-- åœ¨é é¢é ‚éƒ¨æ·»åŠ  App Check ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
    <div id="appCheckStatus" class="initializing">App Check: åˆå§‹åŒ–ä¸­...</div>
    
    <!-- å°èˆªæ¬„ -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <img src="logo.png" alt="BREWDATE" height="40">
                BREWDATE
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#home">é¦–é </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#features">ç‰¹è‰²</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#business">å•†å®¶åˆä½œ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="index.html#download">ä¸‹è¼‰APP</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="business-login.html">åº—å®¶ç™»å…¥</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- æ ¸éŠ·ç³»çµ±å€å¡Š -->
    <section class="verification-section">
        <div class="container verification-container">
            <div class="verification-card">
                <div class="verification-tabs">
                    <div class="verification-tab active" data-tab="scan">æƒæQRç¢¼</div>
                    <div class="verification-tab" data-tab="code">è¼¸å…¥é©—è­‰ç¢¼</div>
                </div>
                
                <div class="verification-content">
                    <h2 class="verification-title">BREWDATE å„ªæƒ æ ¸éŠ·ç³»çµ±</h2>
                    <p class="verification-description">
                        å¿«é€Ÿä¾¿æ·åœ°é©—è­‰é¡§å®¢çš„å„ªæƒ åˆ¸ï¼Œç„¡éœ€ä¸‹è¼‰é¡å¤–æ‡‰ç”¨ã€‚æƒæé¡§å®¢çš„QRç¢¼æˆ–è¼¸å…¥6ä½æ•¸é©—è­‰ç¢¼å³å¯æ ¸éŠ·å„ªæƒ ã€‚
                    </p>
                    
                    <div id="scan-tab" class="tabs-container active">
                        <div class="verification-scanner">
                            <div id="qrScanner">
                                <div class="scan-overlay">
                                    <div class="scan-frame">
                                        <div class="scan-line"></div>
                                    </div>
                                </div>
                                <video id="preview"></video>
                            </div>
                            <button id="requestCameraBtn" class="camera-permission-btn">
                                <i class="fas fa-camera me-2"></i>é–‹å•Ÿæ”å½±æ©Ÿ
                            </button>
                        </div>
                        
                        <div class="verification-form">
                            <button id="scanQrBtn" class="verification-button">
                                <i class="fas fa-qrcode me-2"></i>é–‹å§‹æƒæ
                            </button>
                        </div>
                    </div>
                    
                    <div id="code-tab" class="tabs-container">
                        <div class="verification-form">
                            <div class="verification-input">
                                <label for="verificationCode">é©—è­‰ç¢¼ (6ä½æ•¸)</label>
                                <input type="text" id="verificationCode" maxlength="6" placeholder="è«‹è¼¸å…¥é¡§å®¢APPä¸Šé¡¯ç¤ºçš„6ä½æ•¸é©—è­‰ç¢¼">
                            </div>
                            
                            <button id="verifyCodeBtn" class="verification-button">
                                <i class="fas fa-check-circle me-2"></i>é©—è­‰å„ªæƒ 
                            </button>
                        </div>
                    </div>
                    
                    <div id="verification-result" class="verification-result">
                        <!-- çµæœå°‡é€šéJavaScriptå‹•æ…‹å¡«å…… -->
                    </div>
                </div>
            </div>
            
            <!-- ä½¿ç”¨èªªæ˜ -->
            <div class="row mt-5">
                <div class="col-lg-10 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <h4 class="card-title mb-4"><i class="fas fa-info-circle me-2"></i>å¦‚ä½•ä½¿ç”¨æ ¸éŠ·ç³»çµ±</h4>
                            
                            <div class="row g-4">
                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <div class="text-center mb-3">
                                                <i class="fas fa-qrcode fa-3x text-primary"></i>
                                            </div>
                                            <h5 class="text-center">æƒæQRç¢¼</h5>
                                            <p class="text-muted">é»æ“Šã€Œé–‹å§‹æƒæã€ä¸¦å°æº–é¡§å®¢APPä¸Šçš„QRç¢¼ï¼Œç³»çµ±æœƒè‡ªå‹•è­˜åˆ¥ä¸¦é©—è­‰å„ªæƒ ã€‚</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <div class="text-center mb-3">
                                                <i class="fas fa-keyboard fa-3x text-primary"></i>
                                            </div>
                                            <h5 class="text-center">è¼¸å…¥é©—è­‰ç¢¼</h5>
                                            <p class="text-muted">å¦‚æœç„¡æ³•æƒæQRç¢¼ï¼Œå¯ä»¥è¼¸å…¥é¡§å®¢APPä¸Šé¡¯ç¤ºçš„6ä½æ•¸é©—è­‰ç¢¼é€²è¡Œæ ¸éŠ·ã€‚</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <div class="text-center mb-3">
                                                <i class="fas fa-check-circle fa-3x text-primary"></i>
                                            </div>
                                            <h5 class="text-center">å®Œæˆæ ¸éŠ·</h5>
                                            <p class="text-muted">æ ¸éŠ·æˆåŠŸå¾Œï¼Œç³»çµ±æœƒé¡¯ç¤ºå„ªæƒ è©³æƒ…ï¼Œé¡§å®¢APPä¸Šçš„å„ªæƒ å°‡è¢«æ¨™è¨˜ç‚ºå·²ä½¿ç”¨ã€‚</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- é è…³ -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-lg-4">
                    <div class="footer-info">
                        <h3>BREWDATE</h3>
                        <p>ç”¨ä¸€æ¯å’–å•¡çš„æ™‚é–“ï¼Œæ‰¾åˆ°çœŸå¯¦çš„ç«èŠ±</p>
                        <div class="social-links">
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6">
                    <div class="footer-links">
                        <h4>å¿«é€Ÿé€£çµ</h4>
                        <ul>
                            <li><a href="index.html#home">é¦–é </a></li>
                            <li><a href="index.html#features">ç‰¹è‰²</a></li>
                            <li><a href="index.html#business">å•†å®¶åˆä½œ</a></li>
                            <li><a href="index.html#download">ä¸‹è¼‰æ‡‰ç”¨</a></li>
                            <li><a href="index.html#faq">å¸¸è¦‹å•é¡Œ</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-links">
                        <h4>è¯çµ¡æˆ‘å€‘</h4>
                        <ul>
                            <li><i class="fas fa-envelope"></i> <a href="mailto:info@brewdate.com">info@brewdate.com</a></li>
                            <li><i class="fas fa-phone"></i> <a href="tel:+886912345678">+886 912 345 678</a></li>
                            <li><i class="fas fa-map-marker-alt"></i> <span>å°åŒ—å¸‚ä¿¡ç¾©å€æ¾ä»è·¯ 100 è™Ÿ</span></li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="footer-newsletter">
                        <h4>åº—å®¶è¨‚é–±</h4>
                        <p>è¨‚é–±æˆ‘å€‘çš„é›»å­å ±ï¼Œç²å–æœ€æ–°çš„æ´»å‹•å’Œåˆä½œä¿¡æ¯</p>
                        <form>
                            <div class="input-group">
                                <input type="email" name="email" class="form-control" placeholder="æ‚¨çš„é›»å­éƒµä»¶">
                                <button class="btn btn-primary" type="submit">è¨‚é–±</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <p>&copy; 2025 BREWDATE. ä¿ç•™æ‰€æœ‰æ¬Šåˆ©.</p>
                    </div>
                    <div class="col-md-6">
                        <div class="footer-bottom-links">
                            <a href="#">éš±ç§æ”¿ç­–</a>
                            <a href="#">ä½¿ç”¨æ¢æ¬¾</a>
                            <a href="#">Cookie æ”¿ç­–</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- QR Code æƒæåº« -->
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- åœ¨é é¢æœ€å¾Œæ·»åŠ åˆå§‹åŒ–è…³æœ¬ -->
    <script type="module">
        // å°å…¥å¿…è¦çš„æ¨¡çµ„ï¼Œç¢ºä¿æ­£ç¢ºçš„åˆå§‹åŒ–é †åº
        import { auth, db, appCheck } from './firebase-config.js';
        import { checkAppCheckStatus, getAppCheckToken, installXHRInterceptor, installFetchInterceptor } from './app-check-module.js';
        
        // DOM åŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ– UI å…ƒç´ 
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('é é¢åŠ è¼‰å®Œæˆï¼Œé–‹å§‹è¨­ç½® App Check ç‹€æ…‹æŒ‡ç¤ºå™¨...');
            const statusElement = document.getElementById('appCheckStatus');
            
            try {
                // ç¢ºä¿æ””æˆªå™¨å·²å®‰è£
                installXHRInterceptor();
                installFetchInterceptor();
                
                // å»¶é²åŸ·è¡Œæª¢æŸ¥ï¼Œçµ¦ reCAPTCHA è¶³å¤ çš„åŠ è¼‰æ™‚é–“
                setTimeout(async () => {
                    try {
                        console.log('æª¢æŸ¥ App Check ç‹€æ…‹...');
                        const result = await checkAppCheckStatus();
                        if (result.success) {
                            statusElement.className = 'success';
                            statusElement.textContent = 'App Check: å·²é©—è­‰ âœ“';
                            setTimeout(() => { statusElement.style.display = 'none'; }, 3000);
                            
                            console.log('App Check é©—è­‰æˆåŠŸ');
                            // é å…ˆç²å–ä¸€å€‹ä»¤ç‰Œï¼Œç¢ºä¿å¾ŒçºŒè«‹æ±‚èƒ½ä½¿ç”¨
                            try {
                                const token = await getAppCheckToken();
                                console.log('æˆåŠŸç²å– App Check ä»¤ç‰Œ');
                            } catch (tokenError) {
                                console.error('ç²å– App Check ä»¤ç‰Œå¤±æ•—:', tokenError);
                            }
                        } else {
                            statusElement.className = 'error';
                            statusElement.textContent = 'App Check: é©—è­‰å¤±æ•— âœ—';
                            console.error('App Check é©—è­‰å¤±æ•—:', result.error);
                            setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
                            
                            // é¡¯ç¤ºéŒ¯èª¤æç¤º
                            showAppCheckError();
                        }
                    } catch (error) {
                        statusElement.className = 'error';
                        statusElement.textContent = 'App Check: ç™¼ç”ŸéŒ¯èª¤ âœ—';
                        console.error('App Check åˆå§‹åŒ–éŒ¯èª¤:', error);
                        setTimeout(() => { statusElement.style.display = 'none'; }, 5000);
                        
                        // é¡¯ç¤ºéŒ¯èª¤æç¤º
                        showAppCheckError();
                    }
                }, 2000); // å»¶é² 2 ç§’å¾Œæª¢æŸ¥ï¼Œæé«˜æˆåŠŸç‡
            } catch (error) {
                console.error('è¨­ç½®ç‹€æ…‹æŒ‡ç¤ºå™¨æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
        });
        
        // é¡¯ç¤º App Check éŒ¯èª¤æç¤º
        function showAppCheckError() {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-danger mt-3';
            errorDiv.innerHTML = `
                <strong>App Check é©—è­‰å¤±æ•—</strong>
                <p>é€™å¯èƒ½å°è‡´æ ¸éŠ·åŠŸèƒ½ç„¡æ³•æ­£å¸¸ä½¿ç”¨ã€‚è«‹åˆ·æ–°é é¢é‡è©¦ï¼Œæˆ–è¯ç¹«ç³»çµ±ç®¡ç†å“¡ã€‚</p>
                <button class="btn btn-sm btn-outline-danger mt-2" onclick="location.reload()">åˆ·æ–°é é¢</button>
            `;
            
            // æ·»åŠ åˆ°é é¢
            const verificationContent = document.querySelector('.verification-content');
            if (verificationContent) {
                verificationContent.prepend(errorDiv);
            }
        }
    </script>
</body>
</html>